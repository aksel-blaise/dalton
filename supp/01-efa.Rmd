# Elliptical Fourier Analysis

Prior to running the landmark 3D geometric morphometric (3DGM) analysis, an elliptical Fourier analysis (EFA) was conducted to identify differences in the plan view of Dalton projectile points. These data have utility in developing the subsequent 3D landmarking protocol (LM3d3) used in the 3DGM analysis.

The 2D images used in the EFA were exported as screen captures from _Geomagic Design X_, and are oriented using the same (exact) alignment as the 3D dataset. Each image was masked in Photoshop to render the requisite binary (black/white) image..

## Load packages + data

```{r load.packages.efa, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# load packages
#devtools::install_github("MomX/Momocs")
library(here)
library(tidyverse)
library(wesanderson)
library(Momocs)

# read images + attribute data
jpg.list <- list.files(here("./jpeg"), full.names = TRUE)
att.data <- read.csv("qdata.csv", header = TRUE, as.is = TRUE)

# attributes to factors
att.data$heart.out <- as.factor(att.data$heart.out)
att.data$heart.reg <- as.factor(att.data$heart.reg)
att.data$bev <- as.factor(att.data$bev)
att.data$bev.type <- as.factor(att.data$bev.type)
```

## Generate outlines

```{r outlines + attribues, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# generate outlines
outlines <- jpg.list %>%
  import_jpg()

# add attributes
data.out <- Out(outlines, 
         fac = att.data)

# center, scale, align, and rotate specimens
norm.outlines <- data.out %>% 
  coo_scale() %>%
  coo_rotate() %>% 
  coo_align() %>%
  coo_center()
```

## Calibrate harmonic + EFA

```{r cal.harm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# calibrate how many harmonics needed
calibrate_harmonicpower_efourier(norm.outlines, 
                                 nb.h = 20)

# 10 harmonics capture 99 percent of variation
calibrate_reconstructions_efourier(norm.outlines, 
                                   range = 1:10)

# generate efa outlines with 10 harmonics
efa.outlines <- efourier(norm.outlines, 
                         nb.h = 10, 
                         norm = TRUE)
```

## Principal Components Analysis

```{r pca.plot, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# use efa.outlines for pca
pca.outlines <- PCA(efa.outlines)

# pca 
scree_plot(pca.outlines)

# mean shape + 2sd for the first 5 pcs
PCcontrib(pca.outlines, 
          nax = 1:5)
```

## Test Hypothesis 1 (Geo EFA)

Hypothesis 1 assesses whether there is a difference in the symmetric shape of Dalton points found in and out of the heartland.

```{r lm3d3.a1.h1.efa, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Hypothesis 1 considers whether Dalton points discovered in (left) and out (right) of the Heartland differ in morphology."}
knitr::include_graphics('images/dalton-vizhypothesis1.jpg')
```

### Principal Components Analysis (H1)

```{r pca.h1,, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# plot pca

# heartland in/out
plot_PCA(pca.outlines, 
         morphospace_position = "range",
         palette = pal_qual_solarized,
         chullfilled = TRUE,
         ~heart.out,
         axesnames = TRUE,
         morphospace = TRUE,
         eigen = TRUE,
         center_origin = TRUE,
         zoom = 1.25)
```

### MANOVA (H1)

```{r manova.h1, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# do shapes differ in/out of heartland?
MANOVA(pca.outlines, 'heart.out')
```

### Mean shapes (H1) 

```{r msshape.1, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Mean shapes for in (H) and out (N) of the heartland."}
# mean shapes
ms.1 <- MSHAPES(efa.outlines, 
                ~heart.out)
plot_MSHAPES(ms.1, size = 0.75)
```

## Test Hypothesis 2 (Geo EFA)

Hypothesis 2 assesses whether there is a difference in morphology for Dalton points found in the heartland, the interior, and the northern periphery.

```{r lm3d3.a1.h2.efa, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Hypothesis 2 considers whether Dalton points discovered in the heartland (left), interior (center), and northern periphery (right) differ in morphology."}
knitr::include_graphics('images/dalton-vizhypothesis2.jpg')
```

### Principal Components Analysis (H2)

```{r pca.h2, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# plot pca

# heartland region
plot_PCA(pca.outlines, 
         morphospace_position = "range",
         palette = pal_qual_solarized,
         chullfilled = TRUE,
         ~heart.reg,
         axesnames = TRUE,
         morphospace = TRUE,
         eigen = TRUE,
         center_origin = TRUE,
         zoom = 1.25)
```

### MANOVA + MANOVA_PW (H2)

```{r manova.h2, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# do shapes differ between heartland regions?
MANOVA(pca.outlines, 'heart.reg')
# which?
MANOVA_PW(pca.outlines, 'heart.reg')
```

### Mean shapes (H2)

```{r mean.shape.h2, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Mean shapes for heartland (H), interior (I), and northern periphery (P)."}
# mean shapes
ms.2 <- MSHAPES(efa.outlines, 
                ~heart.reg)
plot_MSHAPES(ms.2, size = 0.75)
```

## Test Hypothesis 3 (Techno EFA)

Hypothesis 3 assesses whether there is a discernible difference in morphology for Dalton points that are beveled.

```{r lm3d3.a1.h3.efa, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Hypothesis 3 considers whether beveled Dalton points (left) differ in morphology from those that are not beveled (right)."}
knitr::include_graphics('images/dalton-vizhypothesis3.jpg')
```

### Principal Components Analysis (H3)

```{r pca.h3, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# beveled or not
plot_PCA(pca.outlines, 
         morphospace_position = "range",
         palette = pal_qual_solarized,
         chullfilled = TRUE,
         ~bev,
         axesnames = TRUE,
         morphospace = TRUE,
         eigen = TRUE,
         center_origin = TRUE,
         zoom = 1.25)
```

### MANOVA (H3)

```{r manova.h3, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# do shapes differ if beveled?
MANOVA(pca.outlines, 'bev')
```

### Mean shapes (H3)

```{r mshape3efa, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Mean shapes for beveled (y), and not beveled (n)."}
# mean shapes
ms.3 <- MSHAPES(efa.outlines, 
                ~bev)
plot_MSHAPES(ms.3, size = 0.75)
```

## Test Hypothesis 4 (Techno EFA)

Hypothesis 4 assesses whether there is a discernible difference in the morphology of specific beveling types associated with Dalton points.

```{r lm3d3.a1.h4.efa, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Hypothesis 4 considers whether discrete beveling practices articulate with differences in the morphology of Dalton points"}
knitr::include_graphics('images/dalton-vizhypothesis4-1.jpg')
```

### Principal Components Analysis (H4)

```{r pca.h4, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
plot_PCA(pca.outlines, 
         morphospace_position = "range",
         palette = pal_qual_solarized,
         chullfilled = TRUE,
         ~bev.type,
         axesnames = TRUE,
         morphospace = TRUE,
         eigen = TRUE,
         center_origin = TRUE,
         zoom = 1.25)
```

### MANOVA + MANOVA_PW (H4)

```{r manova, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# do shapes differ by bevel type?
MANOVA(pca.outlines, 'bev.type')
# which?
MANOVA_PW(pca.outlines, 'bev.type')
```

### Mean shapes (H4)

```{r mshape4efa, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Mean shapes for alternate, unifacial.bimarginal, and no.bevel."}
# mean shapes
ms.4 <- MSHAPES(efa.outlines, 
                ~bev.type)
plot_MSHAPES(ms.4, size = 0.75)
```
