# Bilateral Asymmetry

## Load packages + data

```{r load.data.asymm, echo = TRUE}
# load packages

# devtools::install_github("geomorphR/geomorph", ref = "Stable", build_vignettes = TRUE)
library(geomorph)
library(tidyverse)
library(wesanderson)

# setwd
setwd(getwd())

# read GM data
source('readmulti.csv.R')

# read .csv files
setwd("./data")
filelist <- list.files(pattern = ".csv")
coords <- readmulti.csv(filelist)
setwd("../")

# read qualitative data
qdata <- read.csv("qdata.csv", header = TRUE, row.names = 1)
qdata <- qdata[match(dimnames(coords)[[3]],rownames(qdata)),]
land.pairs<-read.csv("asymmetry1.csv",header=TRUE)
ind<-rep(1:length(filelist))

# print qdata
knitr::kable(qdata, align = "cccc", caption = "Attributes included in qdata.")
```

## Generalized Procrustes Analysis

```{r assym.gpa, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# gpa for bilateral (object) asymmetry
res.bilat <- bilat.symmetry(coords,
                          ind = ind, 
                          object.sym = TRUE,
                          land.pairs = land.pairs,
                          RRPP = TRUE,
                          iter = 9999,
                          print.progress = FALSE)
summary(res.bilat)
```

```{r symm.shape, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Symmetric shape component plotted in 2D."}
# symmetric shape
symm.shape <- res.bilat$symm.shape[,1:2,]
symm.shape2 <- res.bilat$symm.shape[,2:3,]

# plot all specimens in 2D
plotAllSpecimens(symm.shape)
plotAllSpecimens(symm.shape2)
```

```{r asymm.shape, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Asymmetric shape component plotted in 2D."}
# asymmetric shape
asymm.shape<-res.bilat$asymm.shape[,1:2,]
asymm.shape2 <- res.bilat$asymm.shape[,2:3,]

# plot all specimens in 2D
plotAllSpecimens(asymm.shape)
plotAllSpecimens(asymm.shape2)
```

## Principal Components Analsis

```{r pca.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# geomorph data frame
gdf <- geomorph.data.frame(shape = symm.shape, 
                           ashape = asymm.shape,
                           heart = qdata$heart.out, 
                           hreg = qdata$heart.reg,
                           bev.1 = qdata$bev, 
                           bev.2 = qdata$bev.type)

# attributes for boxplots
heart <- qdata$heart.out # heartland in/out
hreg <- qdata$heart.reg # heartland region
bev.1 <- qdata$bev # beveled yes/no
bev.2 <- qdata$bev.type # type of beveling

# principal components analysis
pca<-gm.prcomp(res.bilat$symm.shape)
summary(pca)

# set plot parameters to plot by heartland in (H) and out (N)
pch.gps.heart <- c(15,17)[as.factor(heart)]
col.gps.heart <- wes_palette("Moonrise2")[as.factor(heart)]
col.hull <- c("#798E87","#C27D38")

# plot pca by heartland in (H) and out (N)
pc.plot1 <- plot(pca, 
                 asp = 1,
                 pch = pch.gps.heart,
                 col = col.gps.heart)
                    shapeHulls(pc.plot1, 
                             groups = heart,
                             group.cols = col.hull)

  # mshape                              
  M<-mshape(res.bilat$symm.shape)
  # shapes at the minima and maxima of PC1 and PC2 using min and max
  # corresponding to the x/y values in the four PC plots
  pc <- pca$x[,1] # x-axis
  preds <- shape.predictor(res.bilat$symm.shape, 
                           x = pc, Intercept = FALSE, 
                           pred1 = min(pc), 
                           pred2 = max(pc))
  plotRefToTarget(M, preds$pred1) # minimum x-axis
  plotRefToTarget(M, preds$pred2) # maximum x-axis
  pc <- pca$x[,2] # y-axis
  preds<-shape.predictor(res.bilat$symm.shape, 
                         x = pc, Intercept = FALSE, 
                         pred1 = min(pc), 
                         pred2 = max(pc))
  plotRefToTarget(M, preds$pred1) # minimum y-axis
  plotRefToTarget(M, preds$pred2) # maximum y-axis 
```

```{r pca.asymm2, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# set plot parameters to plot by heartland + regions
pch.gps.hreg <- c(15,17,18)[as.factor(hreg)]
col.gps.hreg <- wes_palette("Moonrise2")[as.factor(hreg)]
col.hull.2 <- c("#798E87","#CCC591","#C27D38")

# plot pca by heartland + regions
pc.plot2 <- plot(pca, 
                 asp = 1,
                 pch = pch.gps.hreg,
                 col = col.gps.hreg)
                    shapeHulls(pc.plot2, 
                             groups = hreg,
                             group.cols = col.hull.2)
```

```{r pca.asymm3, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# set plot parameters to plot by beveled y and n
pch.gps.bev.1 <- c(15,17)[as.factor(bev.1)]
col.gps.bev.1 <- wes_palette("Moonrise2")[as.factor(bev.1)]
col.hull.3 <- c("#C27D38","#798E87")

# plot pca by heartland in (H) and out (N)
pc.plot3 <- plot(pca, 
                 asp = 1,
                 pch = pch.gps.bev.1,
                 col = col.gps.bev.1)
                    shapeHulls(pc.plot3, 
                             groups = bev.1,
                             group.cols = col.hull.3)
```

```{r pca.asymm4, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# set plot parameters to plot by bevel type
pch.gps.bev.2 <- c(15,17,18)[as.factor(bev.2)]
col.gps.bev.2 <- wes_palette("Moonrise2")[as.factor(bev.2)]
col.hull.4 <- c("#CCC591","#C27D38","#798E87")

# plot pca by bevel type
pc.plot4 <- plot(pca, 
                 asp = 1,
                 pch = pch.gps.bev.2,
                 col = col.gps.bev.2)
                    shapeHulls(pc.plot4, 
                             groups = bev.2,
                             group.cols = col.hull.4)
```


## Define models

### Hypothesis 1

```{r def.mod.1.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
## Define models
# symmetric shape as a function of heart
fit.shape.heart <- procD.lm(shape ~ heart, 
                            data = gdf, 
                            print.progress = FALSE, 
                            iter = 9999)

# asymmetric shape as a function of heart
fit.shape.heart.asymm <- procD.lm(ashape ~ heart, 
                            data = gdf, 
                            print.progress = FALSE, 
                            iter = 9999)
```

### Hypothesis 2

```{r def.mod.2.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
## Define models
# symmetric shape as a function of hreg
fit.shape.hreg <- procD.lm(shape ~ hreg, 
                           data = gdf, 
                           print.progress = FALSE, 
                           iter = 9999)

# asymmetric shape as a function of hreg
fit.shape.hreg.asymm <- procD.lm(ashape ~ hreg, 
                           data = gdf, 
                           print.progress = FALSE, 
                           iter = 9999)
```

### Hypothesis 3

```{r def.mod.3.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
## Define models
# symmetric shape as a function of bev.1
fit.shape.bev.1 <- procD.lm(shape ~ bev.1, 
                           data = gdf, 
                           print.progress = FALSE, 
                           iter = 9999)

# asymmetric shape as a function of bev.1
fit.shape.bev.1.asymm <- procD.lm(ashape ~ bev.1, 
                           data = gdf, 
                           print.progress = FALSE, 
                           iter = 9999)
```

### Hypothesis 4

```{r def.mod.4.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
## Define models
# symmetric shape as a function of bev.2
fit.shape.bev.2 <- procD.lm(shape ~ bev.2, 
                           data = gdf, 
                           print.progress = FALSE, 
                           iter = 9999)

# symmetric shape as a function of bev.2
fit.shape.bev.2.asymm <- procD.lm(ashape ~ bev.2, 
                           data = gdf, 
                           print.progress = FALSE, 
                           iter = 9999)
```

## Test Hypothesis 1 (Geo)

Hypothesis 1 assesses whether there is a difference in the symmetric shape of Dalton points found in and out of the heartland.

A residual randomization permutation procedure (RRPP; n = 10,000 permutations) was used for all Procrustes ANOVAs [@RN1655;@RN11775], which has higher statistical power and a greater ability to identify patterns in the data should they be present [@RN1719]. To assess whether shape changes with size (allometry), and differs by group (region), Procrustes ANOVAs [@RN1749] were also run that enlist effect-sizes (zscores) computed as standard deviates of the generated sampling distributions [@RN1756]. 

```{r lm3d3.a1.h1.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Hypothesis 1 considers whether Dalton points discovered in (left) and out (right) of the Heartland differ in morphology."}
knitr::include_graphics('images/dalton-vizhypothesis1.jpg')
```

```{r h1.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# ANOVA: do symmetric dalton projectile point shapes differ by heart?
anova(fit.shape.heart)

# ANOVA: do asymmetric dalton projectile point shapes differ by heart?
anova(fit.shape.heart.asymm)

```

## Test Hypothesis 2 (Geo)

Hypothesis 2 assesses whether there is a difference in morphology for Dalton points found in the heartland, the interior, and the northern periphery.

A residual randomization permutation procedure (RRPP; n = 10,000 permutations) was used for all Procrustes ANOVAs [@RN1655;@RN11775], which has higher statistical power and a greater ability to identify patterns in the data should they be present [@RN1719]. To assess whether shape changes with size (allometry), and differs by group (region), Procrustes ANOVAs [@RN1749] were also run that enlist effect-sizes (zscores) computed as standard deviates of the generated sampling distributions [@RN1756]. 

```{r lm3d3.a1.h2.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Hypothesis 2 considers whether Dalton points discovered in the heartland (left), interior (center), and northern periphery (right) differ in morphology."}
knitr::include_graphics('images/dalton-vizhypothesis2.jpg')
```

```{r h2.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# ANOVA: does symmetric dalton projectile point shape differ by hreg?
anova(fit.shape.hreg)
# pairwise comparison of LS means = which differ?
sh.hreg <- pairwise(fit.shape.hreg, 
                    groups = qdata$heart.reg)
summary(sh.hreg, 
        confidence = 0.95, 
        test.type = "dist")

# ANOVA: does asymmetric dalton projectile point shape differ by hreg?
anova(fit.shape.hreg.asymm)
# pairwise comparison of LS means = which differ?
sh.hreg <- pairwise(fit.shape.hreg.asymm, 
                    groups = qdata$heart.reg)
summary(sh.hreg, 
        confidence = 0.95, 
        test.type = "dist")
```

## Test Hypothesis 3 (Techno)

Hypothesis 3 assesses whether there is a discernible difference in morphology for Dalton points that are beveled.

A residual randomization permutation procedure (RRPP; n = 10,000 permutations) was used for all Procrustes ANOVAs [@RN1655;@RN11775], which has higher statistical power and a greater ability to identify patterns in the data should they be present [@RN1719]. To assess whether shape changes with size (allometry), and differs by group (region), Procrustes ANOVAs [@RN1749] were also run that enlist effect-sizes (zscores) computed as standard deviates of the generated sampling distributions [@RN1756]. 

```{r lm3d3.a1.h3.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Hypothesis 3 considers whether beveled Dalton points (left) differ in morphology from those that are not beveled (right)."}
knitr::include_graphics('images/dalton-vizhypothesis3.jpg')
```

```{r h3.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# ANOVA: do symmetric dalton projectile point shapes differ by beveling?
anova(fit.shape.bev.1)

# ANOVA: do asymmetric dalton projectile point shapes differ by beveling?
anova(fit.shape.bev.1.asymm)
```

## Test Hypothesis 4 (Techno)

Hypothesis 4 assesses whether there is a discernible difference in the morphology of specific beveling types associated with Dalton points.

A residual randomization permutation procedure (RRPP; n = 10,000 permutations) was used for all Procrustes ANOVAs [@RN1655;@RN11775], which has higher statistical power and a greater ability to identify patterns in the data should they be present [@RN1719]. To assess whether shape changes with size (allometry), and differs by group (region), Procrustes ANOVAs [@RN1749] were also run that enlist effect-sizes (zscores) computed as standard deviates of the generated sampling distributions [@RN1756]. 

```{r lm3d3.a1.h4.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Hypothesis 4 considers whether discrete beveling practices articulate with differences in the morphology of Dalton points"}
knitr::include_graphics('images/dalton-vizhypothesis4-1.jpg')
```

```{r h4.asymm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# ANOVA: does symmetric dalton projectile point shape differ by bev.2?
anova(fit.shape.bev.2)
# pairwise comparison of LS means = which differ?
sh.bev.2 <- pairwise(fit.shape.bev.2, 
                    groups = qdata$bev.type)
summary(sh.bev.2, 
        confidence = 0.95, 
        test.type = "dist")

# ANOVA: does asymmetric dalton projectile point shape differ by bev.2?
anova(fit.shape.bev.2.asymm)
# pairwise comparison of LS means = which differ?
sh.bev.2 <- pairwise(fit.shape.bev.2.asymm, 
                    groups = qdata$bev.type)
summary(sh.bev.2, 
        confidence = 0.95, 
        test.type = "dist")
```
